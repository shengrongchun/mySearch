webpackJsonp([1],{"/wAz":function(t,e){},"/xfL":function(t,e){},0:function(t,e){},"0Kc/":function(t,e){},1:function(t,e){},"1mPl":function(t,e){},"44Bo":function(t,e){},"4uCP":function(t,e){},"5HsS":function(t,e){},"7bnT":function(t,e){},AjxE:function(t,e){},BAHr:function(t,e){},BoN9:function(t,e){},Fc11:function(t,e){},JyDa:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n("4uCP"),n("nXbH");var i=n("jFa7"),a=n.n(i),o=(n("VVqU"),n("CKrr")),s=n.n(o),r=(n("ZD0t"),n("oFqZ")),l=n.n(r),c=(n("xpkF"),n("OQP0")),u=n.n(c),d=(n("fqtM"),n("n4bP")),m=n.n(d),p=(n("RJkU"),n("Q3iP")),f=n.n(p),g=(n("S+8z"),n("Urb5")),v=n.n(g),h=(n("5HsS"),n("fp1j")),_=n.n(h),b=(n("7bnT"),n("Tc97")),y=n.n(b),k=(n("rI3P"),n("340D")),w=n.n(k),C=(n("ONfh"),n("AnbK")),F=n.n(C),L=(n("44Bo"),n("x8/L")),x=n.n(L),O=(n("ziMA"),n("/zTz")),D=n.n(O),A=(n("0Kc/"),n("CXBd")),G=n.n(A),M=(n("kDaR"),n("gCB4")),I=n.n(M),S=(n("uezj"),n("BZlA")),T=n.n(S),N=(n("gT1N"),n("qYX6")),$=n.n(N),H=(n("YtW1"),n("Y0bJ")),R=n.n(H),U=(n("/xfL"),n("UOVs")),E=n.n(U),j=(n("k2Oz"),n("fS7w")),q=n.n(j),P=(n("qqnD"),n("lLeV")),K=n.n(P),V=(n("BAHr"),n("Veir")),z=n.n(V),B=(n("vJvE"),n("erho")),X=n.n(B),Y=(n("X0dM"),n("5qDq")),Z=n.n(Y),J=(n("ZfCT"),n("i8a1")),W=n.n(J),Q=(n("Fc11"),n("zlcW")),tt=n.n(Q),et=(n("/wAz"),n("O534")),nt=n("34v0"),it=n.n(nt),at=n("EcfS"),ot={name:"siderLeft",data:function(){return{searchValue:null,type:"friends",transferIndex:null,contextMenuFriData:{menuName:"friends",axios:{x:null,y:null},menulists:[{fnHandler:"delFriend",btnName:"删除好友"}]},contextMenuGroData:{menuName:"groups",axios:{x:null,y:null},menulists:[{fnHandler:"removeGroup",btnName:"退出群组"}]},contextMenuNoticeData:{menuName:"notice",axios:{x:null,y:null},menulists:[{fnHandler:"delNotice",btnName:"删除消息"}]},contextMenuInfoData:{menuName:"info",axios:{x:null,y:null},menulists:[{fnHandler:"delInfo",btnName:"删除会话"}]}}},computed:it()({},Object(at.e)(["user","friendsList","groupsList","currentOne","activeMsgList","counts","noticeList"]),Object(at.c)(["msgListNum"]),{chatSearchList:function(){return this.friendsList.concat(this.groupsList)}}),methods:it()({},Object(at.b)(["changeCurrentOne","addFriendOk","deleteUser","deleteGroup"]),Object(at.d)(["setAddFriOrGroDialog","delNoticeListItem","delActiveMsgListItem","clearCurrentone"]),{showMenu:function(t,e,n){this.transferIndex=e,t.preventDefault();var i=t.clientX,a=t.clientY;n.axios={x:i,y:a}},delFriend:function(t){var e=this;this.$confirm("确定删除好友吗？").then(function(){e.deleteUser(t),e.delActiveMsgListItem(t)}).catch(function(){})},removeGroup:function(t){var e=this;this.$confirm("确定退出群组吗？").then(function(){e.deleteGroup(t),e.delActiveMsgListItem(t)}).catch(function(){})},delNotice:function(t){var e=this;this.$confirm("确定删除消息吗？").then(function(){e.delNoticeListItem(t),"add"==t.type&&e.addError(t)}).catch(function(){})},delInfo:function(t){var e=this;this.$confirm("确定删除会话吗？").then(function(){e.delActiveMsgListItem(t),e.currentOne._id==t._id&&e.clearCurrentone()}).catch(function(){})},search:function(t,e){e(t?this.chatSearchList.filter(this.createFilter(t)):this.chatSearchList)},createFilter:function(t){return function(e){return 0===e.name.toLowerCase().indexOf(t.toLowerCase())}},handleSelect:function(t){this.changeCurrentOne(t)},showDialog:function(t){this.setAddFriOrGroDialog({type:t,show:!0})},changeActiveOne:function(t){var e=this.currentOne;e&&e._id===t._id||this.changeCurrentOne(t)},addOk:function(t){this.addFriendOk({mask:!0,data:t})},addError:function(t){this.addFriendOk({mask:!1,data:t})}})},st={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sider-left"},[n("header",{staticClass:"left-header"},[n("div",{staticClass:"avatar"},[n("img",{attrs:{src:t.user.avatar}})]),t._v(" "),n("div",{staticClass:"info"},[n("span",{staticClass:"display-name"},[t._v(t._s(t.user.name))]),t._v(" "),n("div",{staticClass:"add"},[n("el-dropdown",{staticClass:"dropdown",attrs:{trigger:"click"},on:{command:t.showDialog}},[n("span",{staticClass:"el-dropdown-link"},[n("i",{staticClass:"icon iconfont icon-other"})]),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"friends"}},[t._v("加好友")]),t._v(" "),n("el-dropdown-item",{attrs:{command:"groups"}},[t._v("加群组")]),t._v(" "),n("el-dropdown-item",{attrs:{command:"createGroups"}},[t._v("创建群组")])],1)],1)],1)])]),t._v(" "),n("div",{staticClass:"left-search"},[n("el-autocomplete",{staticClass:"input inline-block",attrs:{"prefix-icon":"el-icon-search",placeholder:"搜索",size:"small","trigger-on-focus":!1,"popper-class":"search-chat-item","fetch-suggestions":t.search},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function(e){return[n("img",{staticClass:"avatar",attrs:{width:"30",src:e.item.avatar}}),t._v(" "),n("span",{staticClass:"name"},[t._v(t._s(e.item.name))])]}}]),model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}})],1),t._v(" "),n("div",{staticClass:"left-body"},[n("div",{staticClass:"tabs"},[n("ul",[n("li",{on:{click:function(e){t.type="info"}}},[n("el-badge",{staticClass:"item",attrs:{value:t.msgListNum,max:99}},["info"==t.type?n("i",{staticClass:"icon iconfont icon-interactive_fill active"}):n("i",{staticClass:"icon iconfont icon-interactive"})])],1),t._v(" "),n("li",{on:{click:function(e){t.type="friends"}}},[n("el-badge",{staticClass:"item",attrs:{value:0,max:99}},["friends"==t.type?n("i",{staticClass:"icon iconfont icon-addressbook_fill active"}):n("i",{staticClass:"icon iconfont icon-addressbook"})])],1),t._v(" "),n("li",{on:{click:function(e){t.type="notice"}}},[n("el-badge",{staticClass:"item",attrs:{value:t.noticeList.length,max:99}},["notice"==t.type?n("i",{staticClass:"icon iconfont icon-remind_fill active"}):n("i",{staticClass:"icon iconfont icon-remind"})])],1)])]),t._v(" "),n("div",{staticClass:"tabs-panel"},["info"==t.type?n("div",[n("el-menu",{staticClass:"left-menu",attrs:{"background-color":"#2e3238","text-color":"#fff","active-text-color":"#ffd04b"}},t._l(t.activeMsgList,function(e,i){return n("el-menu-item",{key:i,attrs:{index:i+""},on:{click:function(n){t.changeActiveOne(e)}}},[n("div",{on:{contextmenu:function(e){t.showMenu(e,i,t.contextMenuInfoData)}}},[n("img",{attrs:{src:e.avatar}}),t._v(" "),n("el-badge",{staticClass:"badge",attrs:{value:t.counts[e._id],max:99}},[n("span",[t._v(t._s(e.name))])])],1),t._v(" "),n("vue-context-menu",{staticClass:"customMenu",attrs:{contextMenuData:t.contextMenuInfoData,transferIndex:t.transferIndex},on:{delInfo:function(n){t.delInfo(e)}}})],1)}))],1):t._e(),t._v(" "),"friends"==t.type?n("div",[n("el-menu",{staticClass:"left-menu",attrs:{"background-color":"#2e3238","text-color":"#fff","active-text-color":"#ffd04b"}},[t.groupsList.length>0?n("el-menu-item-group",{attrs:{title:"群组"}},t._l(t.groupsList,function(e,i){return n("el-menu-item",{key:i,attrs:{index:i+""},on:{click:function(n){t.changeActiveOne(e)}}},[n("div",{on:{contextmenu:function(e){t.showMenu(e,i,t.contextMenuGroData)}}},[n("img",{attrs:{src:e.avatar}}),t._v(" "),n("span",[t._v(t._s(e.name))])]),t._v(" "),n("vue-context-menu",{staticClass:"customMenu",attrs:{contextMenuData:t.contextMenuGroData,transferIndex:t.transferIndex},on:{removeGroup:function(n){t.removeGroup(e)}}})],1)})):t._e(),t._v(" "),n("el-menu-item-group",{attrs:{title:"好友"}},t._l(t.friendsList,function(e,i){return n("el-menu-item",{key:i,attrs:{index:i+""},on:{click:function(n){t.changeActiveOne(e)}}},[n("div",{on:{contextmenu:function(e){t.showMenu(e,i,t.contextMenuFriData)}}},[n("img",{attrs:{src:e.avatar}}),t._v(" "),n("span",[t._v(t._s(e.name))])]),t._v(" "),n("vue-context-menu",{staticClass:"customMenu",attrs:{contextMenuData:t.contextMenuFriData,transferIndex:t.transferIndex},on:{delFriend:function(n){t.delFriend(e)}}})],1)}))],1)],1):t._e(),t._v(" "),"notice"==t.type?n("div",[n("el-menu",{staticClass:"left-menu",attrs:{"background-color":"#2e3238","text-color":"#fff","active-text-color":"#ffd04b"}},t._l(t.noticeList,function(e,i){return n("el-menu-item",{key:i,staticClass:"noticeAddfri",attrs:{index:i+""}},[n("div",{on:{contextmenu:function(e){t.showMenu(e,i,t.contextMenuNoticeData)}}},[n("el-badge",{staticClass:"badge",attrs:{value:1,max:99}},[n("img",{attrs:{src:e.avatar}}),t._v(" "),n("span",[t._v(t._s(e.name))])]),t._v(" "),"resolve"==e.type?n("p",[t._v("同意添加好友")]):t._e(),t._v(" "),"reject"==e.type?n("p",[t._v("拒绝添加好友")]):t._e(),t._v(" "),"add"==e.type?n("p",[t._v("请求添加好友")]):t._e(),t._v(" "),"add"==e.type?n("div",[n("el-button",{attrs:{size:"mini"},on:{click:function(n){t.addError(e)}}},[t._v("不同意")]),t._v(" "),n("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(n){t.addOk(e)}}},[t._v("同意")])],1):t._e()],1),t._v(" "),n("vue-context-menu",{staticClass:"customMenu",attrs:{contextMenuData:t.contextMenuNoticeData,transferIndex:t.transferIndex},on:{delNotice:function(n){t.delNotice(e)}}})],1)}))],1):t._e()])])])},staticRenderFns:[]};var rt=n("ngHh")(ot,st,!1,function(t){n("tqlo")},"data-v-40fa7efe",null).exports,lt={bind:function(t,e,n){var i=function(i){if(!n.context||t.contains(i.target))return!1;e.expression?n.context[t["@@clickoutsideContext"].methodName](i):t["@@clickoutsideContext"].bindingFn(i)};t["@@clickoutsideContext"]={documentHandler:i,methodName:e.expression,bindingFn:e.value},setTimeout(function(){document.addEventListener("click",i)},0)},update:function(t,e){t["@@clickoutsideContext"].methodName=e.expression,t["@@clickoutsideContext"].bindingFn=e.value},unbind:function(t){document.removeEventListener("click",t["@@clickoutsideContext"].documentHandler)}},ct={name:"siderRight",data:function(){return{img:null,faceShow:!1,faceList:[],faceTitleList:[]}},computed:it()({},Object(at.e)(["currentOne","messages","user","counts"]),{messageList:function(){return this.scrollTop(),this.messages[this.currentOne._id]},editDom:function(){return document.getElementById("editArea")}}),methods:it()({},Object(at.b)(["pushMsg","deleteUser","changeCurrentOne"]),{noCurrentNum:function(){this.counts[this.currentOne._id]>0&&this.changeCurrentOne(this.currentOne)},submitMsg:function(){var t=this.editDom.innerHTML;t&&!t.match(/^\s*$/)&&(this.pushMsg(t),this.editDom.innerHTML=null)},handleCommand:function(t){"delete"===t&&this.deleteUser(this.currentOne)},breakLine:function(t){this.editDom.innerHTML=this.editDom.innerHTML+"<br></br>",this.placeCaretAtEnd(this.editDom),this.$nextTick(function(){var e=t.target;e.scrollTop=e.scrollHeight})},placeCaretAtEnd:function(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(e)}else if(void 0!==document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(t),i.collapse(!1),i.select()}},insertPic:function(t){this.img.style.backgroundPositionX=t.x,this.img.style.backgroundPositionY=t.y,this.editDom.appendChild(this.img.cloneNode(!0))},scrollTop:function(){this.$nextTick(function(){document.getElementById("right-body").scrollTop=document.getElementById("right-body").scrollHeight})},hideFace:function(){this.faceShow=!1}}),directives:{clickoutside:lt},mounted:function(){this.img=document.createElement("img"),this.img.width=20,this.img.height=20,this.img.src=n("xet3"),this.img.setAttribute("class","buImg"),this.faceTitleList=["微笑","撇嘴","色","发呆","得意","流泪","害羞","闭嘴","睡","大哭","尴尬","发怒","调皮","呲牙","惊讶","难过","酷","冷汗","抓狂","吐","偷笑","愉快","白眼","傲慢","饥饿","困","惊恐","流汗","憨笑","悠闲","奋斗","咒骂","疑问","嘘","晕","疯了","衰","骷髅","敲打","再见","擦汗","抠鼻","鼓掌","糗大了","坏笑","左哼哼","右哼哼","哈欠","鄙视","委屈","快哭了","阴险","亲亲","吓","可怜","菜刀","西瓜","啤酒","篮球","乒乓","咖啡","饭","猪头","玫瑰","凋谢","嘴唇","爱心","心碎","蛋糕","闪电","炸弹","刀","足球","瓢虫","便便","月亮","太阳","礼物","拥抱","强","弱","握手","胜利","抱拳","勾引","拳头","差劲","爱你","NO","OK","爱情","飞吻","跳跳","发抖","怄火","转圈","磕头","回头","跳绳","投降","激动","乱舞","献吻","左太极","右太极","嘿哈","捂脸","奸笑","机智","皱眉","耶","鸡","红包"];for(var t=0;t<113;t++)this.faceList.push({title:this.faceTitleList[t],class:"face"+t,x:24*-parseInt(t%15)+"px",y:24*-parseInt(t/15)+"px"})}},ut={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sider-right"},[t.currentOne?n("div",[n("div",{staticClass:"right-header"},[n("el-dropdown",{on:{command:t.handleCommand}},[n("span",{staticClass:"el-dropdown-link"},[t._v("\n                "+t._s(t.currentOne.name)),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"delete"}},[t._v("删除用户")])],1)],1)],1),t._v(" "),n("div",{staticClass:"right-body",attrs:{id:"right-body"}},[t.messageList&&t.messageList.length>0?n("div",t._l(t.messageList,function(e,i){return n("div",{key:i,staticClass:"message",class:{me:t.user._id===e._id}},[n("img",{staticClass:"avatar",attrs:{title:e.name,src:e.avatar}}),t._v(" "),n("div",{staticClass:"content"},[t.user._id!==e._id?n("h4",{staticClass:"nickname"},[t._v(t._s(e.name))]):t._e(),t._v(" "),n("div",{staticClass:"bubble",class:{right:t.user._id===e._id,left:t.user._id!==e._id}},[n("div",{staticClass:"bubble_cont"},[n("pre",{domProps:{innerHTML:t._s(e.content)}})])])])])})):n("p",{staticClass:"noMsg"},[t._v("暂时没有新消息")])]),t._v(" "),n("div",{staticClass:"right-footer"},[n("div",{staticClass:"bar"},[t.faceShow?n("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.hideFace,expression:"hideFace"}],staticClass:"face"},[n("div",{staticClass:"faceImg"},t._l(t.faceList,function(e,i){return n("a",{class:"qq "+e.class,style:{backgroundPositionX:e.x,backgroundPositionY:e.y},attrs:{title:e.title},on:{click:function(n){t.insertPic(e)}}},[t._v(t._s(e.title))])}))]):t._e(),t._v(" "),n("span",{on:{click:function(e){e.stopPropagation(),t.faceShow=!0}}},[n("i",{staticClass:"icon iconfont icon-emoji"})])]),t._v(" "),n("div",{staticClass:"submit"},[n("pre",{attrs:{id:"editArea",contenteditable:"true"},on:{focus:function(e){if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)return null;t.noCurrentNum(e)},keydown:[function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key)?(e.stopPropagation(),e.preventDefault(),e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:void t.submitMsg(e)):null},function(e){return("button"in e||!t._k(e.keyCode,"enter",13,e.key))&&e.ctrlKey?(e.stopPropagation(),e.shiftKey||e.altKey||e.metaKey?null:void t.breakLine(e)):null}]}})]),t._v(" "),n("div",{staticClass:"action"},[n("span",[t._v("按下Ctrl+Enter换行")]),t._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.submitMsg(e)}}},[t._v("发送")])],1)])]):n("div")])},staticRenderFns:[]};var dt={name:"weChat",components:{siderLeft:rt,siderRight:n("ngHh")(ct,ut,!1,function(t){n("c/66")},"data-v-6497cbd0",null).exports}},mt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"weChat"},[e("el-row",[e("el-col",{attrs:{span:8}},[e("sider-left")],1),this._v(" "),e("el-col",{attrs:{span:16}},[e("sider-right")],1)],1)],1)},staticRenderFns:[]};var pt={name:"shLogin",data:function(){return{}},components:{weChat:n("ngHh")(dt,mt,!1,function(t){n("BoN9")},"data-v-989a19b4",null).exports},computed:it()({},Object(at.e)(["user","noticeList","isOpen"]),Object(at.c)(["msgListNum"]),{num:function(){return this.noticeList.length+this.msgListNum}}),methods:it()({},Object(at.d)(["setLoginDialog","setOpen"]),Object(at.b)(["logout"]),{handleCommand:function(t){"exit"==t?this.logout():"edit"==t&&this.login("edit")},showChat:function(){this.setOpen(!this.isOpen)},login:function(t){this.setLoginDialog({type:t,centerDialogVisible:!0})}})},ft={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"shLogin"}},[t.user.name?n("div",[n("el-badge",{staticClass:"item",attrs:{value:t.num,max:99}},[n("i",{staticClass:"el-icon-message",on:{click:t.showChat}})]),t._v(" "),n("img",{staticStyle:{verticalAlign:"middle",borderRadius:"3px"},attrs:{src:t.user.avatar,width:"30"}}),t._v(" "),n("el-dropdown",{on:{command:t.handleCommand}},[n("span",{staticClass:"el-dropdown-link"},[t._v("\n                "+t._s(t.user.name)),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"edit"}},[t._v("修改信息")]),t._v(" "),n("el-dropdown-item",{attrs:{command:"exit",divided:""}},[t._v("退出")])],1)],1)],1):n("div",{staticClass:"user"},[n("el-button",{attrs:{type:"text"},on:{click:function(e){t.login("login")}}},[t._v("登录")]),t._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(e){t.login("sign")}}},[t._v("注册")])],1),t._v(" "),n("div",{class:{open:t.isOpen},attrs:{id:"weChat"}},[n("span",{staticClass:"close",on:{click:t.showChat}},[t._v("×")]),t._v(" "),n("we-chat")],1)])},staticRenderFns:[]};var gt=n("ngHh")(pt,ft,!1,function(t){n("1mPl")},"data-v-34f71154",null).exports,vt=n("GxZn"),ht=n.n(vt),_t=n("Edqs"),bt=n.n(_t),yt=(n("ZM3P"),n("haFB")),kt=n.n(yt),wt={props:{trigger:{type:[String,Element],required:!0},uploadHandler:{type:Function},uploadUrl:{type:String},uploadHeaders:{type:Object},uploadFormName:{type:String,default:"file"},uploadFormData:{type:Object,default:function(){return{}}},mimes:{type:String,default:"image/png, image/gif, image/jpeg, image/bmp, image/x-icon"},labels:{type:Object,default:function(){return{submit:"保存",cancel:"取消"}}}},data:function(){return{cropper:void 0,dataUrl:void 0,filename:void 0}},methods:{destroy:function(){this.cropper.destroy(),this.dataUrl=void 0},submit:function(){if(this.uploadUrl)this.uploadImage();else{if(!this.uploadHandler)throw new Error("No upload handler found.");this.uploadHandler(this.cropper)}this.destroy()},pickImage:function(){var t=this,e="avatar-img-input",n=document.querySelector("input#"+e+"[type=file]");null==n&&((n=document.createElement("input")).id=e,n.setAttribute("type","file"),n.setAttribute("accept",this.mimes),n.addEventListener("change",function(){if(null!=n.files&&null!=n.files[0]){var e=new FileReader;e.onload=function(e){t.dataUrl=e.target.result},e.readAsDataURL(n.files[0]),t.filename=n.files[0].fileName||"unknown",t.$emit("changed",n.files[0],e)}})),n.click()},createCropper:function(){var t=document.querySelector(".avatar-cropper-image-container img");this.cropper=new kt.a(t,{aspectRatio:1,autoCropArea:1,viewMode:1,movable:!1,zoomable:!1,minCropBoxWidth:100,minCropBoxHeight:80})},uploadImage:function(){var t=this;this.cropper.getCroppedCanvas().toBlob(function(e){var n=new FormData,i=new XMLHttpRequest,a=bt()({},t.uploadFormData);for(var o in a)n.append(o,a[o]);for(var s in n.append(t.uploadFormName,e,t.filename),t.$emit("uploading",n,i),i.open("POST",t.uploadUrl,!0),t.uploadHeaders)i.setRequestHeader(s,t.uploadHeaders[s]);i.onreadystatechange=function(){if(4===i.readyState){var e=JSON.parse(i.responseText);200===i.status?t.$emit("uploaded",e,n,i):t.$emit("error","Image upload fail.","upload",i)}},i.send(n)})}},mounted:function(){var t="object"==ht()(this.trigger)?this.trigger:document.querySelector(this.trigger);t||this.$emit("error","No avatar make trigger found.","user"),t.addEventListener("click",this.pickImage)}},Ct={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.dataUrl?n("div",{staticClass:"avatar-cropper"},[n("div",{staticClass:"avatar-cropper-mark"},[n("a",{staticClass:"avatar-cropper-close",attrs:{href:"javascript:void(0);"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.destroy(e)}}},[t._v("×")])]),t._v(" "),n("div",{staticClass:"avatar-cropper-container"},[n("div",{staticClass:"avatar-cropper-image-container"},[n("img",{attrs:{src:t.dataUrl,alt:""},on:{load:function(e){e.stopPropagation(),t.createCropper(e)}}})]),t._v(" "),n("div",{staticClass:"avatar-cropper-footer"},[n("button",{staticClass:"avatar-cropper-btn",domProps:{textContent:t._s(t.labels.cancel)},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.destroy(e)}}},[t._v("Cancel")]),t._v(" "),n("button",{staticClass:"avatar-cropper-btn",domProps:{textContent:t._s(t.labels.submit)},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.submit(e)}}},[t._v("Submit")])])])]):t._e()},staticRenderFns:[]};var Ft=n("ngHh")(wt,Ct,!1,function(t){n("V/92")},null,null).exports,Lt={name:"shDialog",components:{AvatarCropper:Ft},watch:{loginDialog:function(t,e){"edit"==t.type&&(this.loginForm.name=this.user.name,this.loginForm.avatar=this.user.avatar,this.avatarSrc=this.user.avatar)}},data:function(){var t=this;return{loading:!1,showTips:!1,avatarSrc:void 0,tips:{type:null,msg:null},loginForm:{name:null,avatar:null,email:null,password:null,pwdAgain:null},rules:{name:[{required:!0,message:"请输入用户名称",trigger:"blur"},{min:1,max:10,message:"长度在 1 到 10 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur,change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:function(e,n,i){if("login"==t.loginDialog.type||!t.loginForm.pwdAgain)return i();n!==t.loginForm.pwdAgain&&t.$refs.loginForm.validateField("pwdAgain"),i()},trigger:"blur"},{min:5,max:10,message:"长度在 5 到 10 个字符",trigger:"blur"}],pwdAgain:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:function(e,n,i){if(!t.loginForm.password)return i();n!==t.loginForm.password?i(new Error("两次输入密码不一致!")):i()},trigger:"blur"},{min:5,max:10,message:"长度在 5 到 10 个字符",trigger:"blur"}]}}},computed:it()({},Object(at.e)(["loginDialog","user"])),methods:it()({},Object(at.d)(["setUser"]),Object(at.b)(["loginSuccess","updateUser"]),{clearData:function(){this.showTips=!1,this.loginForm.name=null,this.loginForm.password=null,this.loginForm.pwdAgain=null,this.loginForm.email=null,this.loginForm.avatar=null},submitForm:function(t){var e=this;this.showTips=!1,this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;"login"==e.loginDialog.type?(e.loading=!0,e.$http.post("/login",{email:e.loginForm.email,password:e.loginForm.password}).then(function(t){e.setUser(t.data),e.tips={type:"ok",msg:t.data.msg},e.loginDialog.centerDialogVisible=!1,e.loginSuccess(t.data)},function(t){e.tips={type:"error",msg:t.data}}).finally(function(){e.loading=!1,e.showTips=!0})):(e.loading=!0,e.$http.post("/sign",e.loginForm).then(function(t){e.setUser(t.data),e.tips={type:"ok",msg:t.data.msg},e.loginDialog.centerDialogVisible=!1,e.loginSuccess(t.data)},function(t){e.tips={type:"error",msg:t.data}}).finally(function(){e.loading=!1,e.showTips=!0}))})},editForm:function(t){var e=this;this.showTips=!1,this.$refs[t].validate(function(t){if(!t)return console.log("error edit!!"),!1;e.loading=!0,e.updateUser(e.loginForm).then(function(t){e.tips={type:"ok",msg:t.ok},e.showTips=!0,e.loading=!1,e.loginDialog.centerDialogVisible=!1},function(t){e.tips={type:"error",msg:t},e.showTips=!0,e.loading=!1})})},resetForm:function(t){this.$refs[t].resetFields()},updateUserAvatar:function(t){var e=t.getCroppedCanvas({width:100,height:80}).toDataURL("image/jpg");this.avatarSrc=e,e&&(this.loginForm.avatar=e)}})},xt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",["edit"!=t.loginDialog.type?n("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{title:"login"==t.loginDialog.type?"登录":"注册",visible:t.loginDialog.centerDialogVisible,width:"35%",center:""},on:{"update:visible":function(e){t.$set(t.loginDialog,"centerDialogVisible",e)},close:function(e){t.loginDialog.centerDialogVisible=!1}}},[n("el-form",{ref:"loginForm",staticClass:"demo-loginForm",attrs:{model:t.loginForm,rules:t.rules,"label-width":"100px","status-icon":""}},["sign"==t.loginDialog.type?n("el-form-item",{attrs:{label:"用户名称",prop:"name"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:t.loginForm.name,callback:function(e){t.$set(t.loginForm,"name",e)},expression:"loginForm.name"}})],1):t._e(),t._v(" "),n("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[n("el-input",{attrs:{type:"email","auto-complete":"off"},model:{value:t.loginForm.email,callback:function(e){t.$set(t.loginForm,"email",e)},expression:"loginForm.email"}})],1),t._v(" "),"sign"==t.loginDialog.type?n("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[t.avatarSrc?n("div",{staticClass:"avatar-image"},[n("img",{attrs:{src:t.avatarSrc}})]):t._e(),t._v(" "),n("el-button",{attrs:{id:"pick-avatar",size:"small"}},[t._v("选择头像")]),t._v(" "),n("avatar-cropper",{attrs:{trigger:"#pick-avatar","upload-handler":t.updateUserAvatar}})],1):t._e(),t._v(" "),n("el-form-item",{attrs:{label:"密码",prop:"password"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1),t._v(" "),"sign"==t.loginDialog.type?n("el-form-item",{attrs:{label:"确认密码",prop:"pwdAgain"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:t.loginForm.pwdAgain,callback:function(e){t.$set(t.loginForm,"pwdAgain",e)},expression:"loginForm.pwdAgain"}})],1):t._e(),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("loginForm")}}},[t._v(t._s("login"==t.loginDialog.type?"登录":"注册"))]),t._v(" "),n("el-button",{on:{click:function(e){t.resetForm("loginForm")}}},[t._v("重置")])],1)],1),t._v(" "),t.showTips?n("span",["error"==t.tips.type?n("el-alert",{attrs:{title:t.tips.msg,type:"error",center:"","show-icon":"",closable:!1}}):t._e()],1):t._e()],1):t._e(),t._v(" "),"edit"==t.loginDialog.type?n("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{title:"修改信息",visible:t.loginDialog.centerDialogVisible,width:"35%",center:""},on:{"update:visible":function(e){t.$set(t.loginDialog,"centerDialogVisible",e)},close:function(e){t.loginDialog.centerDialogVisible=!1}}},[n("el-form",{ref:"loginForm",staticClass:"demo-loginForm",attrs:{model:t.loginForm,rules:t.rules,"label-width":"100px","status-icon":""}},[n("el-form-item",{attrs:{label:"用户名称",prop:"name"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:t.loginForm.name,callback:function(e){t.$set(t.loginForm,"name",e)},expression:"loginForm.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[t.avatarSrc?n("div",{staticClass:"avatar-image"},[n("img",{attrs:{src:t.avatarSrc}})]):t._e(),t._v(" "),n("el-button",{attrs:{id:"pick-avatar",size:"small"}},[t._v("选择头像")]),t._v(" "),n("avatar-cropper",{attrs:{trigger:"#pick-avatar","upload-handler":t.updateUserAvatar}})],1),t._v(" "),n("el-form-item",{attrs:{label:"密码",prop:"password"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"确认密码",prop:"pwdAgain"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:t.loginForm.pwdAgain,callback:function(e){t.$set(t.loginForm,"pwdAgain",e)},expression:"loginForm.pwdAgain"}})],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.editForm("loginForm")}}},[t._v("修改")]),t._v(" "),n("el-button",{on:{click:function(e){t.resetForm("loginForm")}}},[t._v("重置")])],1)],1),t._v(" "),t.showTips?n("span",["error"==t.tips.type?n("el-alert",{attrs:{title:t.tips.msg,type:"error",center:"","show-icon":"",closable:!1}}):t._e()],1):t._e()],1):t._e()],1)},staticRenderFns:[]};var Ot=n("ngHh")(Lt,xt,!1,function(t){n("wM9+")},"data-v-1d8b07a3",null).exports,Dt={name:"shChatDialog",components:{AvatarCropper:Ft},data:function(){return{addFriendsKey:null,addGroupsKey:null,checkedList:[],checkedGroupsList:[],avatarSrc:null,groupsForm:{name:null,avatar:null},rules:{name:[{required:!0,message:"请输入群组名称",trigger:"blur"},{min:1,max:10,message:"长度在 1 到 10 个字符",trigger:"blur"}]}}},computed:it()({},Object(at.e)(["searchResultList","searchResultGroupsList","addFriOrGroDialog"])),methods:it()({},Object(at.b)(["searchUsers","searchGroup","addFriend","addGroup","createGroup"]),Object(at.d)(["setAddFriOrGroDialog"]),{init:function(){this.addFriendsKey=null,this.addGroupsKey=null,this.checkedList=[],this.checkedGroupsList=[],this.avatarSrc=null,this.groupsForm={name:null,avatar:null}},searchFirends:function(){this.addFriendsKey&&this.searchUsers(this.addFriendsKey)},searchGroups:function(){this.addGroupsKey&&this.searchGroup(this.addGroupsKey)},addFriends:function(){for(var t in this.checkedList)this.addFriend(this.checkedList[t]);this.init(),this.setAddFriOrGroDialog({type:null,show:!1})},addGroups:function(){for(var t in this.checkedGroupsList)this.addGroup(this.checkedGroupsList[t]);this.init(),this.setAddFriOrGroDialog({type:null,show:!1})},resetForm:function(t){this.$refs[t].resetFields()},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;e.createGroup(e.groupsForm),e.setAddFriOrGroDialog({type:null,show:!1}),e.init()})},updateUserAvatar:function(t){var e=t.getCroppedCanvas({width:100,height:80}).toDataURL("image/jpg");this.avatarSrc=e,e&&(this.groupsForm.avatar=e)}})},At={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-dialog",{attrs:{size:"tiny",visible:t.addFriOrGroDialog.show},on:{"update:visible":function(e){t.$set(t.addFriOrGroDialog,"show",e)},close:t.init}},[n("el-tabs",{staticClass:"dialog",model:{value:t.addFriOrGroDialog.type,callback:function(e){t.$set(t.addFriOrGroDialog,"type",e)},expression:"addFriOrGroDialog.type"}},[n("el-tab-pane",{attrs:{label:"添加好友",name:"friends"}},[n("el-input",{staticClass:"addInput",attrs:{placeholder:"请输入好友名称 Enter搜索"},on:{change:t.searchFirends},model:{value:t.addFriendsKey,callback:function(e){t.addFriendsKey=e},expression:"addFriendsKey"}},[n("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},on:{click:t.searchFirends},slot:"prefix"})]),t._v(" "),n("div",{staticClass:"searchList"},[n("el-checkbox-group",{model:{value:t.checkedList,callback:function(e){t.checkedList=e},expression:"checkedList"}},t._l(t.searchResultList,function(e,i){return n("el-checkbox",{key:i,staticClass:"addCheck",attrs:{disabled:e.have,label:e}},[n("img",{staticClass:"addImg",attrs:{src:e.avatar}}),t._v(" "),n("h4",{staticClass:"addName"},[t._v(t._s(e.name))]),t._v(" "),e.have?n("span",[t._v("已添加")]):t._e()])}))],1),t._v(" "),n("div",{staticClass:"addBtn"},[n("el-button",{attrs:{disabled:!t.checkedList.length>0,type:"success"},on:{click:t.addFriends}},[t._v("加入"+t._s(t.checkedList.length>0?t.checkedList.length:null))])],1)],1),t._v(" "),n("el-tab-pane",{attrs:{label:"添加群组",name:"groups"}},[n("el-input",{staticClass:"addInput",attrs:{placeholder:"请输入群组名称 Enter搜索"},on:{change:t.searchGroups},model:{value:t.addGroupsKey,callback:function(e){t.addGroupsKey=e},expression:"addGroupsKey"}},[n("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},on:{click:t.searchGroups},slot:"prefix"})]),t._v(" "),n("div",{staticClass:"searchList"},[n("el-checkbox-group",{model:{value:t.checkedGroupsList,callback:function(e){t.checkedGroupsList=e},expression:"checkedGroupsList"}},t._l(t.searchResultGroupsList,function(e,i){return n("el-checkbox",{key:i,staticClass:"addCheck",attrs:{disabled:e.have,label:e}},[n("img",{staticClass:"addImg",attrs:{src:e.avatar}}),t._v(" "),n("h4",{staticClass:"addName"},[t._v(t._s(e.name))]),t._v(" "),e.have?n("span",[t._v("已添加")]):t._e()])}))],1),t._v(" "),n("div",{staticClass:"addBtn"},[n("el-button",{attrs:{disabled:!t.checkedGroupsList.length>0,type:"success"},on:{click:t.addGroups}},[t._v("加入"+t._s(t.checkedGroupsList.length>0?t.checkedGroupsList.length:null))])],1)],1),t._v(" "),n("el-tab-pane",{attrs:{label:"创建群组",name:"createGroups"}},[n("el-form",{ref:"groupsForm",staticClass:"demo-groupsForm",attrs:{model:t.groupsForm,rules:t.rules,"label-width":"100px","status-icon":""}},[n("el-form-item",{attrs:{label:"群组名称",prop:"name"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:t.groupsForm.name,callback:function(e){t.$set(t.groupsForm,"name",e)},expression:"groupsForm.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[t.avatarSrc?n("div",{staticClass:"avatar-image"},[n("img",{attrs:{src:t.avatarSrc}})]):t._e(),t._v(" "),n("el-button",{attrs:{id:"pick-groups-avatar",size:"small"}},[t._v("选择头像")]),t._v(" "),n("avatar-cropper",{attrs:{trigger:"#pick-groups-avatar","upload-handler":t.updateUserAvatar}})],1),t._v(" "),n("el-form-item",[n("el-button",{staticStyle:{"{float":"right}"},attrs:{type:"primary"},on:{click:function(e){t.submitForm("groupsForm")}}},[t._v("创建")]),t._v(" "),n("el-button",{on:{click:function(e){t.resetForm("groupsForm")}}},[t._v("重置")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var Gt=n("ngHh")(Dt,At,!1,function(t){n("ofC9")},"data-v-3ff78e36",null).exports,Mt={name:"shHeader",data:function(){return{scrollTop:0}},props:{value:[String]},computed:{searchModel:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},methods:{search:function(){this.value&&this.$emit("click")},querySearch:function(t,e){e([])},handleScroll:function(){this.scrollTop=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}},mounted:function(){window.addEventListener("scroll",this.handleScroll)},components:{shLogin:gt,shLoginDialog:Ot,shChatDialog:Gt}},It={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{class:{down:0!==t.scrollTop},attrs:{id:"header"}},[n("div",{staticClass:"shHeader"},[n("a",{staticClass:"shImg"}),t._v(" "),n("div",{staticClass:"shSearch"},[n("el-autocomplete",{staticClass:"inline-block",attrs:{"suffix-icon":"el-icon-search",placeholder:"请输入搜索内容",size:"medium","trigger-on-focus":!1,"fetch-suggestions":t.querySearch},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.search(e)}},model:{value:t.searchModel,callback:function(e){t.searchModel=e},expression:"searchModel"}},[n("el-button",{attrs:{slot:"append"},on:{click:t.search},slot:"append"},[t._v("搜索一下")])],1)],1),t._v(" "),n("sh-login")],1)]),t._v(" "),n("sh-login-dialog"),t._v(" "),n("sh-chat-dialog")],1)},staticRenderFns:[]};var St=n("ngHh")(Mt,It,!1,function(t){n("AjxE")},"data-v-2123c560",null).exports,Tt={name:"shBody",data:function(){return{baidu:null,biyin:null,sogou:null,type:"baidu",searchValue:null,loading:!1,biyinType:"in",hostname:window.location.host}},methods:it()({},Object(at.b)(["logout"]),{tabsClick:function(t){this.loading||this[t.name]||!this.searchValue||this.queryClick()},biyinClick:function(){this.searchValue&&this.queryClick()},queryClick:function(t){var e=this;this.loading=!0,this.$http.post("/query",{key:t||encodeURI(this.searchValue),type:this.type,link:!!t,biyinType:this.biyinType}).then(function(t){e[t.data.type]=t.data.data,e.searchValue=decodeURI(t.data.returnKey),window.pageYOffset=0,document.documentElement.scrollTop=0,document.body.scrollTop=0,e.loading=!1},function(t){e[t.data.type]='<div style="text-align:center;">请求出错啦</div>',e.loading=!1})}}),mounted:function(){var t=this;document.onclick=function(e){for(var n=e.target;n.tagName&&"A"!==n.tagName&&n;)n=n.parentNode?n.parentNode:null;if(n&&n.href)return n.host==t.hostname?t.queryClick(n.pathname+n.search):window.open(n.href),!1},window.onbeforeunload=function(){console.log("退出")},window.onunload=function(){t.logout()}},components:{shHeader:St}},Nt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("sh-header",{on:{click:t.queryClick},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),t._v(" "),n("div",{staticClass:"clearfix",attrs:{id:"body"}},[n("div",{staticClass:"gap"}),t._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"bodyQuery",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.6)"}},[n("el-tabs",{on:{"tab-click":t.tabsClick},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[n("el-tab-pane",{attrs:{name:"baidu"}},[n("span",{attrs:{slot:"label"},slot:"label"},[t._v("百度")]),t._v(" "),n("div",{domProps:{innerHTML:t._s(t.baidu)}})]),t._v(" "),n("el-tab-pane",{attrs:{name:"biyin"}},[n("span",{attrs:{slot:"label"},slot:"label"},[t._v("必应")]),t._v(" "),n("el-radio-group",{attrs:{size:"small"},on:{change:t.biyinClick},model:{value:t.biyinType,callback:function(e){t.biyinType=e},expression:"biyinType"}},[n("el-radio-button",{attrs:{label:"in"}},[t._v("国内版")]),t._v(" "),n("el-radio-button",{attrs:{label:"out"}},[t._v("国际版")])],1),t._v(" "),n("div",{domProps:{innerHTML:t._s(t.biyin)}})],1),t._v(" "),n("el-tab-pane",{attrs:{name:"sogou"}},[n("span",{attrs:{slot:"label"},slot:"label"},[t._v("搜狗")]),t._v(" "),n("div",{domProps:{innerHTML:t._s(t.sogou)}})])],1)],1),t._v(" "),n("div",{staticClass:"bodynews"},[t._v("\n            .......\n        ")])])],1)},staticRenderFns:[]};var $t={name:"App",components:{shBody:n("ngHh")(Tt,Nt,!1,function(t){n("JyDa")},"data-v-05931714",null).exports}},Ht={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("sh-body")],1)},staticRenderFns:[]};var Rt=n("ngHh")($t,Ht,!1,function(t){n("Wn9o")},null,null).exports,Ut=n("jGYP"),Et={loginDialog:{type:"login",centerDialogVisible:!1},addFriOrGroDialog:{type:null,show:!1},user:{_id:null,name:null,avatar:null},searchResultList:[],searchResultGroupsList:[],friendsList:[],groupsList:[],currentOne:null,messages:{},activeMsgList:[],counts:{},noticeList:[],isOpen:!1},jt={resetState:function(t){t.user={_id:null,name:null,avatar:null},t.counts={},t.searchResultList=[],t.searchResultGroupsList=[],t.friendsList=[],t.groupsList=[],t.currentOne=null,t.messages={},t.activeMsgList=[],t.noticeList=[],t.isOpen=!1},loginError:function(t,e){t.user={_id:null,name:null,avatar:null},alert(e.msg)},setOpen:function(t,e){t.isOpen=e},setLoginDialog:function(t,e){t.loginDialog=e},setAddFriOrGroDialog:function(t,e){t.searchResultList=[],t.searchResultGroupsList=[],t.addFriOrGroDialog=e},setUser:function(t,e){t.user=e},setSearchResult:function(t,e){t.searchResultList=e},setSearchGroupsResult:function(t,e){t.searchResultGroupsList=e},setFriendsList:function(t,e){t.friendsList=e},setGroupsList:function(t,e){t.groupsList=e},pushGroupsList:function(t,e){t.groupsList.push(e)},pushFriendsList:function(t,e){t.friendsList.push(e)},deleteFriendsList:function(t,e){for(var n in t.friendsList)if(t.friendsList[n]._id===e._id)return void t.friendsList.splice(n,1)},deleteGroupsList:function(t,e){for(var n in t.groupsList)if(t.groupsList[n]._id===e._id)return void t.groupsList.splice(n,1)},changeCurrentOne:function(t,e){t.currentOne=e,et.default.set(t.counts,e._id,0)},clearCurrentone:function(t){et.default.set(t.counts,currentOne._id,0),t.currentOne=null},pushMsg:function(t,e){if(t.messages[e.msgId])t.messages[e.msgId].push(e);else if(et.default.set(t.messages,e.msgId,[e]),e.groupId){for(var n=0;n<t.groupsList.length;n++)if(t.groupsList[n]._id==e.groupId)return void t.activeMsgList.push({name:t.groupsList[n].name,owner:t.groupsList[n].owner,avatar:t.groupsList[n].avatar,_id:e.groupId})}else t.activeMsgList.push({name:e._id?t.currentOne.name:e.name,avatar:e.avatar,_id:e.msgId})},addCount:function(t,e){t.counts[e]?(t.counts[e]=parseInt(t.counts[e])+1,et.default.set(t.counts,e,t.counts[e])):et.default.set(t.counts,e,1)},addFriendOk:function(t,e){t.noticeList.push(e)},delNoticeListItem:function(t,e){for(var n in t.noticeList)if(t.noticeList[n]._id===e._id)return void t.noticeList.splice(n,1)},delActiveMsgListItem:function(t,e){for(var n in t.messages[e._id]=null,t.activeMsgList)if(t.activeMsgList[n]._id===e._id)return void t.activeMsgList.splice(n,1)}},qt=n("UIuv"),Pt=n.n(qt),Kt=n("3SZ7"),Vt=n.n(Kt),zt=n("KdrC"),Bt=n.n(zt).a.connect("/");function Xt(t,e,n){!function(){for(var t in Bt.$events)void 0!=t&&Bt.removeAllListeners(t)}(),Bt.on("message",function(t){var i=t.from,a=t.content,o=t.groupId;o?(n("pushMsg",{groupId:o,name:i.name,avatar:i.avatar,msgId:o,content:a}),e.currentOne&&e.currentOne._id==o&&e.isOpen||n("addCount",o)):(n("pushMsg",{name:i.name,avatar:i.avatar,msgId:i._id,content:a}),e.currentOne&&e.currentOne._id==i._id&&e.isOpen||n("addCount",i._id)),e.isOpen||window.vue.$notify({title:i.name,dangerouslyUseHTMLString:!0,position:"bottom-right",message:a.indexOf("<img")>-1?"[图片]":a}),Bt.emit("message",{ok:"信息成功送达"})}),Bt.on("addFriendOk",function(t){var e=t.from;e.type="add",n("addFriendOk",e)})}var Yt=function(t){return new Pt.a(function(e,n){Bt.emit("loginSuccess",t),Bt.once("loginSuccess",function(t){return"error"===t.type?n(t):e(t)})})},Zt=function(t){return new Pt.a(function(e,n){Bt.emit("getFriends",{from:t}),Bt.once("getFriends",function(t){return t.msg||t.message?n(t):e(t)})})},Jt=function(t){var e=t.keyword,n=t.from;return new Pt.a(function(t,i){Bt.emit("searchUsers",{keyword:e,from:n}),Bt.once("searchUsers",function(e){return e.msg||e.message?i(e):t(e)})})},Wt=function(t){return new Pt.a(function(e,n){Bt.emit("addFriend",t),Bt.once("addFriend",function(t){return t.error?n(t.error):e(t.ok)})})},Qt=function(t){return new Pt.a(function(e,n){Bt.emit("addFriendOk",t),Bt.once("okAddFriend",function(t){return t.error?n(t.error):e(t.ok)})})},te=function(t){return new Pt.a(function(e,n){Bt.emit("pushMsg",t),Bt.once("pushMsg",function(t){return t.error?n(t.error):e(t.ok)})})},ee=function(t){return new Pt.a(function(e,n){Bt.emit("logout",t),Bt.once("logout",function(t){return t.error?n(t.error):e(t.ok)})})},ne=function(t){return new Pt.a(function(e,n){Bt.emit("removeFriend",t),Bt.once("removeFriend",function(t){return t.error?n(t.error):e(t.ok)})})},ie=function(t){return new Pt.a(function(e,n){Bt.emit("createGroup",t),Bt.once("createGroup",function(t){return t.error?n(t.error):e(t)})})},ae=function(t){return new Pt.a(function(e,n){Bt.emit("getGroups",{from:t}),Bt.once("getGroups",function(t){return t.error?n(t.error):e(t)})})},oe=function(t){return new Pt.a(function(e,n){Bt.emit("removeGroup",t),Bt.once("removeGroup",function(t){return t.error?n(t.error):e(t)})})},se=function(t){var e=t.keyword,n=t.from;return new Pt.a(function(t,i){Bt.emit("searchGroups",{keyword:e,from:n}),Bt.once("searchGroups",function(e){return e.error?i(e.error):t(e)})})},re=function(t){return new Pt.a(function(e,n){Bt.emit("addGroup",t),Bt.once("addGroup",function(t){return t.error?n(t.error):e(t)})})},le=function(t){return new Pt.a(function(e,n){Bt.emit("updateUser",t),Bt.once("updateUser",function(t){return t.msg||t.message?n(t):e(t)})})},ce={loginSuccess:function(t,e){var n=t.state,i=t.commit;return Yt(e).then(function(t){Zt(n.user._id).then(function(t){i("setFriendsList",t)}),ae(n.user._id).then(function(t){i("setGroupsList",t),function(t,e,n){for(var i in t)Bt.on(t[i]._id,function(t){t.from;var e=t.data;window.vue.$notify({title:e.name,dangerouslyUseHTMLString:!0,position:"bottom-right",message:e.content})})}(t)}),Xt(0,n,i)},function(t){i("loginError",t)})},searchUsers:function(t,e){var n=t.state,i=t.commit;return Jt({keyword:e,from:n.user._id}).then(function(t){for(var e in t)Vt()(n.friendsList).indexOf(Vt()(t[e]))>-1&&(t[e].have=!0);i("setSearchResult",t)})},searchGroup:function(t,e){var n=t.state,i=t.commit;return se({keyword:e,from:n.user._id}).then(function(t){for(var e in t)Vt()(n.groupsList).indexOf(Vt()(t[e]._id))>-1&&(t[e].have=!0);i("setSearchGroupsResult",t)})},addFriend:function(t,e){var n=t.state,i=t.commit;return Wt({from:{_id:n.user._id,name:n.user.name,avatar:n.user.avatar},friendId:e._id}).then(function(t){i("pushFriendsList",e),e.type="resolve",i("addFriendOk",e)},function(t){e.type="reject",i("addFriendOk",e)})},addFriendOk:function(t,e){var n=t.state,i=t.commit;return i("delNoticeListItem",e.data),Qt({_id:n.user._id,ok:e.mask}).then(function(t){i("pushFriendsList",e.data)},function(t){console.log(t)})},changeCurrentOne:function(t,e){(0,t.commit)("changeCurrentOne",e)},pushMsg:function(t,e){var n=t.state,i=t.commit,a={from:n.user,content:e};return n.currentOne.owner?a.groupId=n.currentOne._id:a.friendId=n.currentOne._id,i("pushMsg",{name:n.user.name,avatar:n.user.avatar,_id:n.user._id,msgId:n.currentOne._id,content:e}),te(a).then(function(t){console.log(t)},function(t){alert(t)})},logout:function(t,e){var n=t.commit,i=t.state;return ee(i.user).then(function(t){n("resetState")},function(t){alert(t)})},deleteUser:function(t,e){var n=t.commit,i=t.state;return ne({fromId:i.user._id,friendId:e._id}).then(function(t){i.currentOne=null,n("deleteFriendsList",{name:e.name,_id:e._id})},function(t){alert(t)})},deleteGroup:function(t,e){var n=t.commit,i=t.state;return oe({fromId:i.user._id,groupId:e._id}).then(function(t){var a;i.currentOne=null,n("deleteGroupsList",{name:e.name,_id:e._id}),a=e._id,Bt.removeAllListeners(a)},function(t){alert(t)})},createGroup:function(t,e){var n=t.commit,i=t.state;return ie({from:i.user._id,data:{name:e.name,avatar:e.avatar}}).then(function(t){n("pushGroupsList",{name:e.name,avatar:t.avatar,_id:t.groupId,owner:i.user._id})},function(t){alert(t)})},addGroup:function(t,e){var n,i=t.commit,a=t.state;return n=e._id,Bt.on(n,function(t){t.from;var e=t.data;window.vue.$notify({title:e.name,dangerouslyUseHTMLString:!0,position:"bottom-right",message:e.content})}),re({from:a.user._id,groupId:e._id}).then(function(){i("pushGroupsList",{name:e.name,avatar:e.avatar,_id:e._id,owner:e.owner})})},updateUser:function(t,e){var n=t.commit,i=t.state,a={from:i.user._id,data:e};return new Pt.a(function(t,o){le(a).then(function(a){n("setUser",{_id:i.user._id,name:e.name,avatar:e.avatar}),t(a)},function(t){o(t)})})}};et.default.use(at.a);var ue=new at.a.Store({state:Et,getters:{msgListNum:function(t){var e=0;for(var n in t.counts)e+=t.counts[n];return e}},mutations:jt,actions:ce}),de=n("S1F6"),me=n.n(de);et.default.use(me.a),et.default.config.productionTip=!1,et.default.use(Ut.a),et.default.use(tt.a),et.default.use(W.a),et.default.use(Z.a),et.default.use(X.a),et.default.use(z.a),et.default.use(K.a),et.default.use(q.a.directive),et.default.use(E.a),et.default.use(R.a),et.default.use($.a),et.default.use(T.a),et.default.use(I.a),et.default.use(G.a),et.default.use(D.a),et.default.use(x.a),et.default.use(F.a),et.default.use(w.a),et.default.use(y.a),et.default.use(_.a),et.default.use(v.a),et.default.use(f.a),et.default.use(m.a),et.default.use(u.a),et.default.use(l.a),et.default.prototype.$notify=s.a,et.default.prototype.$confirm=a.a.confirm,window.vue=new et.default({el:"#app",store:ue,components:{App:Rt},template:"<App/>"})},ONfh:function(t,e){},RJkU:function(t,e){},"S+8z":function(t,e){},"V/92":function(t,e){},VVqU:function(t,e){},Wn9o:function(t,e){},X0dM:function(t,e){},YtW1:function(t,e){},ZD0t:function(t,e){},ZM3P:function(t,e){},ZfCT:function(t,e){},"c/66":function(t,e){},fqtM:function(t,e){},gT1N:function(t,e){},k2Oz:function(t,e){},kDaR:function(t,e){},nXbH:function(t,e){},ofC9:function(t,e){},qqnD:function(t,e){},rI3P:function(t,e){},tqlo:function(t,e){},uezj:function(t,e){},vJvE:function(t,e){},"wM9+":function(t,e){},xet3:function(t,e){t.exports="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},xpkF:function(t,e){},ziMA:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.f07eb27722193799a0dd.js.map